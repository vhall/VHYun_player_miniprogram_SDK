module.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s=t=>{let e=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],i=-1;for(let s=0;s<t.length;s++)i=i>>>8^e[255&(i^t.charCodeAt(s))];return(-1^i)>>>0};class a{constructor(){this.END_OF_INPUT=-1,this.base64Chars=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],this.base64Str=null,this.base64Count=null}setBase64Str(t){this.base64Str=t,this.base64Count=0}readBase64(){if(!this.base64Str)return this.END_OF_INPUT;if(this.base64Count>=this.base64Str.length)return this.END_OF_INPUT;const t=255&this.base64Str.charCodeAt(this.base64Count);return this.base64Count+=1,t}encodeBase64(t){let e,i,s="";this.setBase64Str(t);const a=new Array(3);for(e=0,i=!1;!i&&(a[0]=this.readBase64())!==this.END_OF_INPUT;)a[1]=this.readBase64(),a[2]=this.readBase64(),s+=this.base64Chars[a[0]>>2],a[1]!==this.END_OF_INPUT?(s+=this.base64Chars[a[0]<<4&48|a[1]>>4],a[2]!==this.END_OF_INPUT?(s+=this.base64Chars[a[1]<<2&60|a[2]>>6],s+=this.base64Chars[63&a[2]]):(s+=this.base64Chars[a[1]<<2&60],s=`${s}=`,i=!0)):(s+=this.base64Chars[a[0]<<4&48],s=`${s}=`,s=`${s}=`,i=!0),e+=4,e>=76&&(s=`${s}\n`,e=0);return s}}class r{constructor(){this.Base64=new a,this.sessionId=r.random(),this.monitor_api="/monitor",this.playHeart=null,this.playMessage=null,this.biz_des02=2,this.pf="9",this.ver="0.1.5",this.browerUA="miniprogram",this.waitingTimes=0;const{brand:t,model:e,version:i,system:s,platform:o,SDKVersion:l}=wx.getSystemInfoSync();this.min_system={brand:t,model:e,version:i,system:s,platform:o,SDKVersion:l},this.logTime={playMessageLogTime:(new Date).getTime(),pauseMessageLogTime:0},this.playMessageLog=this.playMessageLog.bind(this),this.heartbeatMessageLog=this.heartbeatMessageLog.bind(this)}initUpLog(t){this.url=t.url,this.biz_role=t.biz_role,this.biz_id=t.biz_id,this.biz_des01=t.biz_des01,this.biz_des02=t.biz_des02,this.bu=t.bu,this.uid=t.uid,this.aid=t.aid,this.vid=t.vid,this.app_id=t.app_id;let e=this.url.split("/").length>=3?this.url.split("/")[2]:"t-dc.e.vhall.com";this.monitor_url=`https://${e}${this.monitor_api}`}static random(){const t=[1,2,3,4,5,6,7,8,9];return(new Date).valueOf()+String(t[Math.floor(Math.random()*t.length)])+String(t[Math.floor(Math.random()*t.length)])+String(t[Math.floor(Math.random()*t.length)])}static outPutConsole(t,e){console[t](e)}push(t){wx.request({url:t,method:"GET",success:()=>{},fail:t=>{console.error(`uplog failed!! ${t}`)}})}json2base64(t){return this.Base64.encodeBase64(JSON.stringify(t).replace(/\s+/g,"")).replace(/\s+/g,"")}generalMessage(){return{s:this.sessionId,uid:this.uid,aid:this.aid,fd:this.currentPath,sd:this.currentHostname,p:this.aid,pf:this.pf,ver:this.ver,bu:this.bu,vid:this.vid,vfid:this.vid,vtype:2,app_id:this.app_id,min_system:this.min_system,ua:this.browerUA}}generalPush(t,e){const i=r.random(),s=this.json2base64(e),a=`${this.url}?k=${t}&id=${i}&s=${this.sessionId}&bu=${this.bu}&token=${s}`;this.push(a)}startPlayLog(){let t,e=this.generalMessage();if(delete e.fd,delete e.sd,delete e.p,"live"===this.playType)t=102001,e.vtype="flv";else{if("vod"!==this.playType)return void console.error("type error");t=92001,e.record_id=this.aid,e.vtype="hls"}this.generalPush(t,e)}pausePlayLog(){if("live"==this.playType)return void r.outPutConsole("error","player Type error");if((new Date).getTime()-this.logTime.pauseMessageLogTime<500)return;let t=this.generalMessage();t.record_id=this.aid,this.logTime.pauseMessageLogTime=(new Date).getTime(),this.generalPush(92002,t)}playMessageLog(t=!1){if((new Date).getTime()-this.logTime.playMessageLogTime<500)return;let e,i=this.generalMessage();if(i={bc:this.waitingTimes,bt:0,biz_role:this.biz_role,biz_id:this.biz_id,biz_des01:this.biz_des01,biz_des02:this.biz_des02,bitrate:Math.ceil(this.streamState.netStatus.videoBitrate+this.streamState.netStatus.audioBitrate),errcode:2002,flow_type:2,tf:Math.ceil(30*(this.streamState.netStatus.videoBitrate+this.streamState.netStatus.audioBitrate)*1024/8),videoWidth:this.streamState.netStatus.videoWidth,videoHeight:this.streamState.netStatus.videoHeight,uf:0,picture_quality:this.currentQuality,os:!1,...i},"live"===this.playType)e=102002,i.protocol="flv";else{if("vod"!==this.playType)return void r.outPutConsole("error","player Type error");e=92005,i.record_id=this.aid,i.protocol="hls"}i.tt=t?Math.ceil((new Date).getTime()-this.logTime.playMessageLogTime):3e4,this.waitingTimes=0,this.logTime.playMessageLogTime=(new Date).getTime(),this.generalPush(e,i)}heartbeatMessageLog(){let t,e=this.generalMessage();if(e={tt:6e4,tf:Math.ceil(30*(this.streamState.netStatus.videoBitrate+this.streamState.netStatus.audioBitrate)*1024/8),...e},"live"===this.playType)t=102003;else{if("vod"!==this.playType)return void r.outPutConsole("error","player Type error");t=92003,e.record_id=this.aid,e.picture_quality=this.currentQuality,e.protocol="hls"}this.generalPush(t,e)}playErrorMessageLog(t){let e,i=this.generalMessage();if(i={_m:t.detail,tf:Math.ceil(30*(this.streamState.netStatus.videoBitrate+this.streamState.netStatus.audioBitrate)*1024/8),...i},"live"===this.playType)e=104001,i.errcode=4001;else{if("vod"!==this.playType)return void r.outPutConsole("error","player Type error");e=94002,i.record_id=this.aid}this.generalPush(e,i)}videoEndMessageLog(){if("live"==this.playType)return;let t=this.generalMessage();t={protocol:"hls",record_id:this.aid,...t},this.generalPush(92006,t)}videoPlayMessageLog(){if("live"==this.playType)return;let t=this.generalMessage();t={protocol:"hls",record_id:this.aid,...t},this.generalPush(92004,t)}videoPauseMessageLog(){if("live"==this.playType)return;let t=this.generalMessage();t={protocol:"hls",record_id:this.aid,...t},this.generalPush(92002,t)}startPlayMessageLog(){this.playMessage||(this.playMessage=setInterval(()=>{this.playMessageLog()},3e4))}stopPlayMessageLog(){this.playMessage&&clearInterval(this.playMessage),this.playMessage=null}startPlayHeartLog(){this.playHeart||(this.playHeart=setInterval(()=>{this.heartbeatMessageLog()},6e4))}stopPlayHeartLog(){this.playHeart&&clearInterval(this.playHeart),this.playHeart=null}waitingLog(){this.waitingTimes++}}i.d(e,"default",(function(){return o}));class o extends r{constructor(){super(),this.currentHostname="",this.currentPath="",this.dispatchDomain="https://gslb.e.vhall.com",this.qualityList=[],this.qualityListKeyWords=null,this.viewUrl={},this.token=null,this.currentQuality=null,this.streamState={code:0,netStatus:{videoBitrate:0,audioBitrate:0,videoFPS:0,videoGOP:0,netSpeed:0,netJitter:0,videoWidth:0,videoHeight:0}},this.createInstance=this.createInstance.bind(this)}spliceUrl(){let t;return t="live"==this.playType?"https://api.vhallyun.com/sdk/v1/room/get-watch-info?client=js&package_check=peter&room_id=":"https://api.vhallyun.com/sdk/v1/demand/get-record-watch-info?client=js&package_check=peter&record_id=",t+`${this.aid}&app_id=${this.app_id}&third_party_user_id=${this.account_Id}&access_token=${this.access_token}`}getCurrentUrl(){let t;if(this.currentQuality)t=`${this.viewUrl[this.currentQuality][0][this.qualityListKeyWords]}?token=${this.token}`;else try{t=`${this.viewUrl[this.defaultQuality][0][this.qualityListKeyWords]}?token=${this.token}`,this.currentQuality=this.defaultQuality}catch(e){const i=["same","1080p","720p","480p","360p","a"];for(const e of i)if(this.qualityList.includes(e)){t=`${this.viewUrl[e][0][this.qualityListKeyWords]}?token=${this.token}`,this.currentQuality=e;break}}return this.updateHost(t),t}async createInstance({type:t,access_token:e,account_Id:i,aid:s,app_id:a,playerId:r,THIS:o=null,otherOption:l={},defaultQuality:h=null},n,d){if(!(t&&e&&i&&s&&a&&r))throw new Error("错误的参数");let u,p;if(this.playType=t,this.access_token=e,this.account_Id=i,this.aid=s,this.app_id=a,this.playerId=r,this.THIS=o,this.defaultQuality=h,l={biz_role:"",biz_id:"",biz_des01:"",biz_des02:"",...l},this.initUpLog({uid:i,aid:s,url:"https://dc.e.vhall.com/login",bu:1,vid:i,app_id:a,...l}),[u,p]=await this.to(this.request(this.spliceUrl())),u)return void d(u);this.fetchSrc(p.default_server,p.definition),this.dispatchDomain=p.dispatch_server;this.qualityList=["same","1080p","720p","480p","360p","a"].filter(t=>!!Object.keys(this.viewUrl).includes(t)),n(this.getCurrentUrl()),this.startPlayLog(this.playType)}getQualityList(){return this.qualityList}switchQualityLevel(t){if(!this.qualityList.includes(t))return void console.error("无效的清晰度");this.currentQuality=t;const e=`${this.viewUrl[this.currentQuality][0][this.qualityListKeyWords]}?token=${this.token}`;return this.updateHost(e),e}updateHost(t){this.currentHostname=/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/.exec(t)[0],this.currentPath=t.split(".com")[1]}fetchSrc(t,e){let i=t.token,a=s(i.split("_")[0].split("").reverse().join("")).toString(16);this.token=a.toUpperCase()+"_"+i.split("_")[1],"live"==this.playType?(this.viewUrl=t.httpflv_urls,this.qualityListKeyWords="httpflv_url"):t.hls_domainnames?(e.forEach(e=>{this.viewUrl[e]=[],t.hls_domainnames.forEach(t=>{let i={hls_domainname:t.hls_domainname,line:t.line};"same"!==e&&(i.hls_domainname=t.hls_domainname.replace(/()\.m3u8$/,`_${e}.m3u8`)),this.viewUrl[e].push(i)})}),this.qualityListKeyWords="hls_domainname"):(e.forEach(e=>{this.viewUrl[e]=[],t.mp4_domainnames.forEach(t=>{let i={mp4_domainname:"",line:t.line};i.mp4_domainname=t.mp4_domainname,"same"!==e&&(i.mp4_domainname=t.mp4_domainname.replace(/()\.mp4$/,`_${e}.mp4`)),this.viewUrl[e].push(i)})}),this.qualityListKeyWords="mp4_domainname")}getPlayer(){return"live"==this.playType?wx.createLivePlayerContext(this.playerId,this.THIS):wx.createVideoContext(this.playerId,this.THIS)}destory(){this.stopPlayMessageLog(),this.stopPlayHeartLog()}play(t){this.getPlayer().play(t),this.startPlayMessageLog(),this.startPlayHeartLog(),"live"!=this.playType&&this.videoPlayMessageLog()}pause(t){this.getPlayer().pause(t),this.playMessageLog(!0),this.stopPlayMessageLog(),this.stopPlayHeartLog(),"live"!=this.playType&&this.videoPauseMessageLog()}resume(t){"live"==this.playType?(this.getPlayer().resume(t),this.startPlayMessageLog(),this.startPlayHeartLog()):r.outPutConsole("warn","video组件无resume方法")}stop(t){this.getPlayer().stop(t),this.stopPlayMessageLog(),this.stopPlayHeartLog(),"live"!=this.playType&&this.videoEndMessageLog()}requestFullScreen(t){this.getPlayer().requestFullScreen(t)}exitFullScreen(t){this.getPlayer().exitFullScreen(t)}mute(t){"live"==this.playType?this.getPlayer().mute(t):r.outPutConsole("warn","video组件无mute方法")}snapshot(t){"live"==this.playType?this.getPlayer().snapshot(t):r.outPutConsole("warn","video组件无snapshot方法")}seek(t){this.getPlayer().seek(t)}sendDanmu(t){this.getPlayer().sendDanmu(t)}playbackRate(t){this.getPlayer().playbackRate(t)}showStatusBar(){this.getPlayer().showStatusBar()}hideStatusBar(){this.getPlayer().hideStatusBar()}onVideoPlay(t){this.startPlayMessageLog(),this.startPlayHeartLog()}onVideoPause(t){this.playMessageLog(!0),this.stopPlayMessageLog(),this.stopPlayHeartLog()}onVideoEnd(t){this.videoEndMessageLog(t)}onVideoError(t){this.playErrorMessageLog(t)}onVideoWaiting(t){}onStateChange(t){(-2301==t.detail.code||-2302==t.detail.code||-2101==t.detail.code||-2102==t.detail.code||-2107==t.detail.code||t.detail.code>3e3)&&this.playErrorMessageLog(t),2105==t.detail.code&&this.waitingLog()}onNetStatus(t){this.streamState.netStatus.videoBitrate=t.detail.info.videoBitrate?t.detail.info.videoBitrate:this.streamState.netStatus.videoBitrate,this.streamState.netStatus.audioBitrate=t.detail.info.audioBitrate?t.detail.info.audioBitrate:this.streamState.netStatus.audioBitrate,this.streamState.netStatus.videoFPS=t.detail.info.videoFPS?t.detail.info.videoFPS:this.streamState.netStatus.videoFPS,this.streamState.netStatus.videoGOP=t.detail.info.videoGOP?t.detail.info.videoGOP:this.streamState.netStatus.videoGOP,this.streamState.netStatus.netSpeed=t.detail.info.netSpeed?t.detail.info.netSpeed:this.streamState.netStatus.netSpeed,this.streamState.netStatus.netJitter=t.detail.info.netJitter?t.detail.info.netJitter:this.streamState.netStatus.netJitter,this.streamState.netStatus.videoWidth=t.detail.info.videoWidth?t.detail.info.videoWidth:this.streamState.netStatus.videoWidth,this.streamState.netStatus.videoHeight=t.detail.info.videoHeight?t.detail.info.videoHeight:this.streamState.netStatus.videoHeight}request(t){return new Promise((e,i)=>{wx.request({url:t,method:"GET",success:t=>{const s=t.data;if(200!==s.code)return console.error("call sdk api failed, code =",s.code),void i(s);e(s.data)},fail:t=>{console.error("call sdk api failed!!"),i(t)}})})}to(t){return t.then(t=>[null,t]).catch(t=>[t])}delay(t){return new Promise(e=>{setTimeout(()=>{e()},t)})}}}]);